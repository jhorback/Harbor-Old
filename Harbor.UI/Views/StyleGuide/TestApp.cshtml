@{
	ViewBag.Title = "Test App";
}
@section pageheader {
	
}
<div class="page-content">

	
	<div data-templatefor="testApp" class="clear margin-bottom">
		<button data-event="clickTestButton">Test Button</button>
		<h1 name="bar" data-bind="class: h1Class"></h1>
		<div data-templatefor="testAppMainView" data-model="subModel">
			SUB TEMPLATE ! - {{bar}} <span name="bar" data-event="clickTestButton"></span> - that was bar - should be baz
			<div data-templatefor="testAppMainView2">
				<span name="bar" data-event="clickTestButton"></span>
			</div>
		</div>
	
		<button data-event="mousedown: clickTestButton" data-bind="title: bar, class: h1Class">Test Button 2</button>
	</div>

	

</div>

@section scripts {
	<script>
		var ta = app("testApp").use("bbext");
		ta.start(["app", function (app) {

			// debugger;
			app.render();

		}]);



		ta.model("foo", {
			defaults: {
				bar: "baz"
			},
			h1Class: {
				get: function () {
					var x = parseInt(this.get("bar"));
					if (x > 10) {
						return "disabled";
					}
					if (x % 2 === 0) {
						return "attn";
					}
					return "";
				},
				bind: ["bar"]
			}
		});

		ta.view("testApp", ["options", "modelFactory", function (options, modelFactory) { // why wasn't error being thrown when options was not there?

			this.modelFactory = modelFactory;

		}], {
			initialize: function () {
				var model;
				this.x = 0;

				this.model = this.modelFactory.create("foo");
				this.model.subModel = this.modelFactory.create("foo");
				this.model.subModel.set("bar", "high");
				model = this.model;

				//setInterval(function () {
				//	model.set("bar", model.get("bar") + ", " + (x++));
				//}, 1000);

			},

			clickTestButton: function () {
				console.log("Clicked");
				this.model.set("bar", (this.x++));
				// this.model.set("bar", this.model.get("bar") + ", " + (this.x++));
			}
		});

		ta.view("testAppMainView2", {
			initialize: function () {
				var model = this.model;
			}
		});


		ta.view("testAppMainView", {
			clickTestButton: function () {
				console.log("clicked 2");
			}
		});

		ta.start();
	</script>
}
